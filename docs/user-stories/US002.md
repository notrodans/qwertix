# User Story: Multiplayer Rooms & Racing

**ID:** US002  
**Priority:** High  
**Estimate:** Extra Large  
**Epic:** Multiplayer Gameplay

## Story

As a player, I want to create and join game rooms with friends so that we can compete in real-time typing races with shared settings.

## Acceptance Criteria

- [ ] Users can create a room and generate a unique invite link to share with others
- [ ] Room transitions correctly through states: `LOBBY`, `COUNTDOWN`, `RACING`, `FINISHED`
- [ ] Host can toggle configuration between `WORDS` (fixed count) and `TIME` (fixed duration) modes
- [ ] In `WORDS` mode, the race ends for everyone immediately when the first player finishes
- [ ] In `TIME` mode, the race ends for everyone when the timer expires
- [ ] Settings changes made by the host are reflected instantly for all peers in the room
- [ ] Server authoritatively calculates WPM and Accuracy while frontend shows placeholders
- [ ] Users can playback the race history (scrub, pause, play) after finishing a race
- [ ] Users are returned to the `LOBBY` state after results to prepare for the next race

## Notes

- Uses WebSockets (`ws`) for low-latency real-time events
- Server is the single source of truth for all game states and win conditions
- `PLAYER_LEFT` events should handle disconnections gracefully without crashing the room

## Tasks

- [ ] Implement `RoomManager` and `Room` entities in the backend
- [ ] Create WebSocket event handlers for race lifecycle (`COUNTDOWN_START`, `RACE_START`, `RACE_FINISHED`)
- [ ] Build Frontend `MultiplayerRoom` feature slice and UI
- [ ] Implement Replay system with scrubbing capabilities
